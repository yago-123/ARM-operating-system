/*------------------------------------------------------------------------------

	"xf_3.c" : programa de test para cifrar texto mediante XOR;
				(versión 1.0)
	
	Imprime diversos mensajes por ventana, comprobando el funcionamiento de
	la inserción de valores con distintos formatos, con o sin traspaso del
	límite de la última columna de la ventana.

------------------------------------------------------------------------------*/

#include <GARLIC_API.h>
#define TEXT_SIZE 27

/* unciphered_text = Lorem Ipsum is simply dummy text of the printing and typesetting industry. 
	Lorem Ipsum has been the industry's standard dummy text ever since the 1500s */ 
char uncipher_text_glob[151] = {0x4c, 0x6f, 0x72, 0x65, 0x6d, 0x20, 0x49, 0x70, 
					0x73, 0x75, 0x6d, 0x20, 0x69, 0x73, 0x20, 0x73, 0x69, 0x6d, 
					0x70, 0x6c, 0x79, 0x20, 0x64, 0x75, 0x6d, 0x6d, 0x79, 0x20, 
					0x74, 0x65, 0x78, 0x74, 0x20, 0x6f, 0x66, 0x20, 0x74, 0x68, 
					0x65, 0x20, 0x70, 0x72, 0x69, 0x6e, 0x74, 0x69, 0x6e, 0x67, 
					0x20, 0x61, 0x6e, 0x64, 0x20, 0x74, 0x79, 0x70, 0x65, 0x73, 
					0x65, 0x74, 0x74, 0x69, 0x6e, 0x67, 0x20, 0x69, 0x6e, 0x64, 
					0x75, 0x73, 0x74, 0x72, 0x79, 0x2e, 0x20, 0x4c, 0x6f, 0x72, 
					0x65, 0x6d, 0x20, 0x49, 0x70, 0x73, 0x75, 0x6d, 0x20, 0x68, 
					0x61, 0x73, 0x20, 0x62, 0x65, 0x65, 0x6e, 0x20, 0x74, 0x68, 
					0x65, 0x20, 0x69, 0x6e, 0x64, 0x75, 0x73, 0x74, 0x72, 0x79, 
					0x27, 0x73, 0x20, 0x73, 0x74, 0x61, 0x6e, 0x64, 0x61, 0x72, 
					0x64, 0x20, 0x64, 0x75, 0x6d, 0x6d, 0x79, 0x20, 0x74, 0x65, 
					0x78, 0x74, 0x20, 0x65, 0x76, 0x65, 0x72, 0x20, 0x73, 0x69, 
					0x6e, 0x63, 0x65, 0x20, 0x74, 0x68, 0x65, 0x20, 0x31, 0x35, 
					0x30, 0x30, 0x73};

char cipher_text_glob[151]; 

int len(char str[]){
    int i = 0; 
    while(str[i] != '\0') {
        i++; 
    }
    
    return i; 
}

void xifrat(char cipher_text[], char plain_text[], char key) {
	int i; 
    for(i = 0; i < len(plain_text); i++) {
        cipher_text[i] = plain_text[i] ^ key; 
    }
	
	cipher_text[len(plain_text)] = '\0'; 
}

void desxifrat(char uncipher_text[], char cipher_text[], char key) {
    xifrat(uncipher_text, cipher_text, key); 
}

int _start(int arg)
{   
	int i; 
	char cipher_text[TEXT_SIZE];
	char uncipher_text[TEXT_SIZE]; 

	char key = (char)5+(arg*10);  
	char plain_text[] = {"Lorem ipsum dolor sit amet"}; 
	
	GARLIC_printf("Text xifrat: \n"); 
	xifrat(cipher_text, plain_text, key); 
	GARLIC_printf("%s\n", cipher_text);
	
	GARLIC_printf("Text desxifrat: \n"); 
	desxifrat(uncipher_text, cipher_text, key); 
	GARLIC_printf("%s\n\n", uncipher_text);
	
	GARLIC_printf("Text xifrat secundari: \n"); 
	for(i = 0; i < 151; i++) {
		cipher_text_glob[i] = uncipher_text_glob[i] ^ key; 
		GARLIC_printf("%c", cipher_text_glob[i]); 
	} 
	
	GARLIC_printf("\nText desxifrat secundari: \n"); 
	for(i = 0; i < 151; i++) {
		GARLIC_printf("%c", cipher_text_glob[i] ^ key); 
	}
	
	GARLIC_printf("\n"); 
	
	
    return 0;
}
